<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>大阪城　歴史クイズ</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
</head>
<style>
    body {
        background-color: #CB3DEE
    }
</style>

<body>
    <div class="container">
        <div align="center">
            <h1>
                <span id="myIndex">1</span>問目（全<span id="myTotal">5</span>問）<br>
                <br>
                <div id="myQuestion">大阪城を建てた人は誰？</div>
                <input name="myRadio" type="radio" id="myRadio0"> <span name="myCase">大工さん</span> <br>
                <input name="myRadio" type="radio" id="myRadio1"> <span name="myCase">藤堂高虎</span> <br>
                <input name="myRadio" type="radio" id="myRadio2"> <span name="myCase">徳川秀忠</span> <br>
                <input name="myRadio" type="radio" id="myRadio3"> <span name="myCase">豊臣秀吉</span> <br>
            </h1>
            <script type="text/javascript">
                var qdata = [ // クイズデータ（全体としては配列）
                    // １問分は連想配列で、{ q:質問文, a:回答群 } という形、回答群は配列で、正答を最初の要素に置く
                    { q: "真田丸の戦いが行われたのはいつ？", a: ["12月4日", "12月3日", "12月1日", "12月8日"] },
                    { q: "大阪城の面積は何k㎡？(本丸の東にある、大坂城公園を含む)", a: ["1.62k㎡", "1.76k㎡", "1.94k㎡", "1.11k㎡"] },
                    { q: "豊臣家が建てた「大坂城」の「天守」は「地上6階地下2階」だったが、大坂の陣で焼け落ちたあと徳川家が建てた「大坂城」の「天守」は何階建て？", a: ["地上5階地下1階", "地上6階地下なし", "地上6階地下3階", "地上5階地下2階"] },
                    { q: "大阪城天守閣は何年に有形文化財に登録された？", a: ["昭和6年(1931年)", "昭和5年(1930年)", "昭和47年(1972年)", "昭和31年(1956年)"] },
                    { q: "大阪城の堀の深さは何ｍ？", a: ["5.2ｍ", "6.1ｍ", "7.1ｍ", "4.6ｍ"] } // 配列の最終要素の次に , は書かない（書くと IE ではエラーになる）
                ];

                var qsel; // 今、選択されている問題
                var qidx; // 今、何問消化したか
                var corr; // 正答数
                // 実は、上の３変数も、qdata にまとめてしまう事は出来る（し、その方が望ましい）が、分かりやすさのため独立の変数にしてある

                window.onload = init; // HTML が描画されたら自動開始される関数を設定（<body onload="～"> と同等）



                function init() { // 「最初の画面・状況」を作る関数
                    // クイズの出題状態を初期化
                    for (var i = 0; i < qdata.length; i++) {
                        qdata[i].stat = 0; // qdata の各要素に、新しいプロパティ stat を追加し、0 を設定（0 は未出題とする）
                        // この結果、qdata の１要素は、{ q:質問文, a:回答群, stat:0 } という形になる
                        // （このように、プロパティを後から自在に追加出来るのが JavaScript の大きな特徴）
                    }

                    // 全何問かを表示
                    document.getElementById("myTotal").innerHTML = qdata.length;

                    // 各ラジオボタンを初期化
                    var rb = document.getElementsByName("myRadio");
                    for (i = 0; i < rb.length; i++) {
                        rb[i].id = ("myRadio" + i); // 独立した id 属性を追加する（プロパティの追加と同様）
                        rb[i].onclick = judgeSelect; // クリックした時の処理関数を設定する
                    }

                    // 出題数を初期化
                    qidx = 0;
                    // 正答数を初期化
                    corr = 0;

                    // 最初の出題をする
                    myChoice(); // 最初の問題を選ぶ
                    myQuest(); // 出題する
                    // 後の処理は、ラジオボタンを押された時の処理に委ねる（イベント駆動）
                }



                function myChoice() { // クイズデータからランダムに次の出題を選ぶ関数
                    // 全て出題済みなら、「選択出来ない」
                    if (qidx >= qdata.length) {
                        qsel = -1; // （この部分は実行されないはずであるが）あえて異常値を設定
                    }

                    // ランダム選出する
                    qsel = Math.floor(Math.random() * qdata.length);
                    // ランダム選出位置のクイズ状態がすでに出題済みならば、
                    while (qdata[qsel].stat > 0) {
                        qsel++; // その次を選び出す
                        if (qsel >= qdata.length) { // 「その次」がクイズ状態の総数を超えたら、
                            qsel = 0; // リセットする
                        }
                    } // 未出題が見つかるまで繰り返す
                }



                function myQuest() { // クイズを出題する
                    // まず、ラジオボタンのチェックを全て外す
                    var rb = document.getElementsByName("myRadio");
                    for (var i = 0; i < rb.length; i++) {
                        rb[i].checked = false;
                    }

                    // 出題数、出題文を表示
                    document.getElementById("myIndex").innerHTML = (qidx + 1);
                    document.getElementById("myQuestion").innerHTML = qdata[qsel].q;

                    // クイズの選択肢をコピーした配列を作り、シャッフルする
                    var ac = Object.create(qdata[qsel].a);
                    for (i = 0; i < 4; i++) { // シャッフルの回数は適当
                        var rd1 = Math.floor(Math.random() * qdata[qsel].a.length);
                        var rd2 = Math.floor(Math.random() * qdata[qsel].a.length);
                        var t = ac[rd1];
                        ac[rd1] = ac[rd2];
                        ac[rd2] = t;
                    }

                    // シャッフルした選択肢を表示する
                    var cs = document.getElementsByName("myCase");
                    for (i = 0; i < cs.length; i++) {
                        cs[i].innerHTML = ac[i];
                    }

                    // 出題済みにする
                    qdata[qsel].stat = 1;
                }



                function judgeSelect() { // ラジオボタンが選択された時の処理をする関数
                    // この関数が呼ばれる時は、すでに出題はされている

                    // どのラジオボタンが押されたのかを取得する
                    var idArr = this.id.split("myRadio"); // 押されたラジオボタンの id 属性を "myRadio" で分割した配列を得る
                    var id = idArr[1]; // 分割された２番目（０から数えて１番目）に数字があるのでそれを取り出す

                    // 正誤判定をする
                    var cs = document.getElementsByName("myCase"); // 選択肢を取得
                    if (cs[id].innerHTML == qdata[qsel].a[0]) { // 選んだラジオボタンに相当する選択内容が、正答と合致するかどうか判定
                        alert("正解です！");
                        corr++; // 正答数を加算
                    }
                    else {
                        alert("間違っています！");
                    }

                    // 消化数を加算
                    qidx++;

                    // 全問出題したかどうか判定
                    if (qidx >= qdata.length) {
                        alert("終了です！全" + qdata.length + "問のうち、" + corr + "問が正解でした！");

                        // 正答数に応じてリアクションが必要なら、ここに処理を書く

                        alert("（次に進む）");
                        // また最初から出題する
                        init();
                    }
                    else {
                        // 次の出題をする
                        myChoice(); // 問題を選ぶ
                        myQuest(); // 出題する
                    }
                }
            </script>
            <h1>
                <p>
                    <input type="button" onclick="location.href='./top.html'" value="HOME"
                        class="btn btn-info btn-lg">
                </p>
            </h1>
        </div>
    </div>

</body>

</html>
